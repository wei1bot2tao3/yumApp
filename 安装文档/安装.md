fail2ban 安装
git clone https://github.com/fail2ban/fail2ban.git
cd fail2ban
    sudo python setup.py install
sudo python3 setup.py install

常用命令
fail2ban-client -h
sudo fail2ban-client reload
sudo fail2ban-client start
sudo fail2ban-client status 

sudo fail2ban-client unban --all
解封 IP 地址：
sudo fail2ban-client set <jail-name> unbanip <ip-address>
显示当前被封禁的 IP 地址列表：
sudo fail2ban-client status <jail-name> | grep "Banned IP"
手动测试过滤规则：
sudo fail2ban-client test mysqld-iptables /var/log/mysql/mysqld.log
git clone https://github.com/fail2ban/fail2ban.git /root/ && cd /root/fail2ban

批量安装
ansible all -i hosts -m ping
ansible-playbook -i hosts clone_fail2ban.yml
sudo systemctl stop fail2ban
sudo systemctl daemon-reload
sudo systemctl restart fail2ban

ansible-playbook -i /etc/ansible/hosts py3.yml



172.31.254.73
172.31.254.72
172.31.254.62
172.31.254.53
scp /etc/fail2ban/jail.d/sshd.local 172.31.254.52:/etc/fail2ban/jail.d/

        

        
yum install epel-release -y
    yum -y install fail2ban


/etc/systemd/system/fail2ban.service

ansible py3 -a "bash /etc/fail2ban/action.d/dingtalk.sh" --extra-vars "local_ip=$(hostname -I | awk '{print $1}')"

sudo fail2ban-client set sshd banip 10.126.62.26
sudo fail2ban-client set <JAIL> unbanip <IP_ADDRESS>
/etc/systemd/system/fail2ban.service
[Unit]
Description=Fail2Ban Service
Documentation=man:fail2ban(1)
After=network.target iptables.service firewalld.service ip6tables.service ipset.service nftables.service
PartOf=iptables.service firewalld.service ip6tables.service ipset.service nftables.service

[Service]
Type=simple
Environment="PYTHONNOUSERSITE=1"
ExecStartPre=/bin/mkdir -p /run/fail2ban
ExecStart=/usr/local/bin/fail2ban-server -xf start
# if should be logged in systemd journal, use following line or set logtarget to sysout in fail2ban.local
# ExecStart=/usr/local/bin/fail2ban-server -xf --logtarget=sysout start
ExecStop=/usr/local/bin/fail2ban-client stop
ExecReload=/usr/local/bin/fail2ban-client reload
PIDFile=/run/fail2ban/fail2ban.pid
Restart=on-failure
RestartPreventExitStatus=0 255

[Install]
WantedBy=multi-user.target
记得修改配置文件
[root@localhost bin]# fail
fail2ban-client     fail2ban-regex      fail2ban-testcases  
fail2ban-python     fail2ban-server     faillock 